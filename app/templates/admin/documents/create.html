{% extends 'admin/model/create.html' %}

{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    {% include 'admin/documents/partials/styles.html' ignore missing %}
{% endblock %}

{% block tail %}
    {{ super() }}
    {% include 'admin/documents/partials/scripts.html' ignore missing %}
{% endblock %}

{% block body %}
    {{ super() }}
{% endblock %}

{% block create_form %}
    <form action="{{ url_for('.create_view') }}" method="POST" enctype="multipart/form-data">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <div class="row">
            <div class="col-lg-8 col-xl-9">
                <div class="admin-card mb-3">
                    <div class="admin-card__header">
                        <div class="admin-card__title"><i class="fa fa-file-alt mr-2"></i>基础信息</div>
                        <div class="admin-card__sub text-muted">填写文档的标题、组织、分类等字段</div>
                    </div>
                    <div class="admin-card__body">
                        <div id="admin-form-fields-source" class="d-none">{{ lib.render_form_fields(form, form_opts) }}</div>
                        <!-- 分组容器：由脚本把对应字段移动进来 -->
                        <div class="admin-section">
                            <div class="admin-section__title">归属</div>
                            <div class="admin-section__body" id="sec-ownership"></div>
                        </div>
                        <div class="admin-section">
                            <div class="admin-section__title">标题与摘要</div>
                            <div class="admin-section__body" id="sec-titles"></div>
                        </div>
                        <div class="admin-section">
                            <div class="admin-section__title">元数据</div>
                            <div class="admin-section__body" id="sec-meta"></div>
                        </div>
                        <div class="admin-section">
                            <div class="admin-section__title">定价</div>
                            <div class="admin-section__body" id="sec-pricing"></div>
                        </div>
                        <div class="admin-section">
                            <div class="admin-section__title">语言与链接</div>
                            <div class="admin-section__body" id="sec-language"></div>
                        </div>
                        <div class="admin-section admin-section--system" id="sec-system-wrap" style="display:none;">
                            <div class="admin-section__title">系统字段（只读）</div>
                            <div class="admin-section__body" id="sec-system"></div>
                        </div>
                        <div class="admin-section" id="sec-others-wrap" style="display:none;">
                            <div class="admin-section__title">其他</div>
                            <div class="admin-section__body" id="sec-others"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-xl-3">
                <div class="admin-card mb-3">
                    <div class="admin-card__header">
                        <div class="admin-card__title"><i class="fa fa-cloud-upload-alt mr-2"></i>文件上传</div>
                        <div class="admin-card__sub text-muted">支持拖拽或点击上传，自动直传 R2</div>
                    </div>
                    <div class="admin-card__body">
                        {% include 'admin/documents/partials/uploads.html' %}
                    </div>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-end mt-3">
            <button type="submit" class="btn btn-primary btn-lg px-4">
                <i class="fa fa-save mr-2"></i>保存
            </button>
        </div>

        <!-- 固定浮动保存栏 -->
        <div class="admin-sticky-bar" id="admin-sticky-save">
            <div class="admin-sticky-bar__inner">
                <div class="d-flex align-items-center">
                    <a class="btn btn-light mr-2" href="{{ url_for('admin_documents.index_view') }}"><i class="fa fa-arrow-left mr-1"></i>返回列表</a>
                    <div class="admin-sticky-bar__info"><i class="fa fa-circle mr-1 text-primary"></i>可随时保存更改</div>
                </div>
                <div class="admin-sticky-bar__actions">
                    <button type="submit" class="btn btn-primary px-4"><i class="fa fa-save mr-2"></i>保存</button>
                </div>
            </div>
        </div>
    </form>
{% endblock %}
